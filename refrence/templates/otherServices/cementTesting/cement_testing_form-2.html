{% extends "base.html" %}

{% block title %}Cement Testing - 2{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-secondary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="h3 mb-0"><i class="fas fa-industry me-2"></i>Cement Testing - 2</h1>
                            <p class="mb-0">Determination of Soundness of Cement</p>
                        </div>
                        <div>
                            <a href="{{ url_for('other_services') }}" class="btn btn-warning me-2">
                                <i class="fas fa-arrow-left me-2"></i>Back to Other Services
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <form method="POST" class="needs-validation" novalidate>
        <!-- Form Navigation Buttons -->
        <div class="row mb-2">
            <div class="col-12">
                <div class="card">
                    <div class="card-body py-2">
                        <div class="d-flex justify-content-center">
                            <a href="{{ url_for('cement_testing_form_1') }}" class="btn btn-outline-primary btn-lg me-5" style="font-size: 1.5rem; font-weight: bold; width: 80px; height: 80px; border-radius: 50%; margin-right: 5rem !important; display: flex; align-items: center; justify-content: center;">
                                1
                            </a>
                            <a href="{{ url_for('cement_testing_form_2') }}" class="btn btn-primary active btn-lg mx-5" style="font-size: 1.5rem; font-weight: bold; width: 80px; height: 80px; border-radius: 50%; margin-left: 5rem !important; margin-right: 5rem !important; display: flex; align-items: center; justify-content: center;">
                                2
                            </a>
                            <a href="{{ url_for('cement_testing_form_3') }}" class="btn btn-outline-primary btn-lg mx-5" style="font-size: 1.5rem; font-weight: bold; width: 80px; height: 80px; border-radius: 50%; margin-left: 5rem !important; margin-right: 5rem !important; display: flex; align-items: center; justify-content: center;">
                                3
                            </a>
                            <a href="{{ url_for('cement_testing_form_4') }}" class="btn btn-outline-primary btn-lg mx-5" style="font-size: 1.5rem; font-weight: bold; width: 80px; height: 80px; border-radius: 50%; margin-left: 5rem !important; margin-right: 5rem !important; display: flex; align-items: center; justify-content: center;">
                                4
                            </a>
                            <a href="{{ url_for('cement_testing_form_5') }}" class="btn btn-outline-primary btn-lg ms-5" style="font-size: 1.5rem; font-weight: bold; width: 80px; height: 80px; border-radius: 50%; margin-left: 5rem !important; display: flex; align-items: center; justify-content: center;">
                                5
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- General Information -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>General Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="sample_description" class="form-label">Sample Description *</label>
                                    <textarea class="form-control" id="sample_description" name="sample_description" rows="3" placeholder="Describe the cement sample..." required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="date_of_receipt" class="form-label">Date of Receipt *</label>
                                    <input type="date" class="form-control" id="date_of_receipt" name="date_of_receipt" required>
                                </div>
                                <div class="mb-3">
                                    <label for="cement_type" class="form-label">Type of Cement *</label>
                                    <select class="form-select" id="cement_type" name="cement_type" required>
                                        <option value="">-- Select Cement Type --</option>
                                        <option value="Ordinary Portland Cement (OPC)">Ordinary Portland Cement (OPC)</option>
                                        <option value="Portland Pozzolana Cement (PPC)">Portland Pozzolana Cement (PPC)</option>
                                        <option value="Portland Blast Furnace Cement (PBFC)">Portland Blast Furnace Cement (PBFC)</option>
                                        <option value="Rapid Hardening Cement">Rapid Hardening Cement</option>
                                        <option value="Quick Setting Cement">Quick Setting Cement</option>
                                        <option value="Low Heat Cement">Low Heat Cement</option>
                                        <option value="Sulfate Resisting Cement">Sulfate Resisting Cement</option>
                                        <option value="White Cement">White Cement</option>
                                        <option value="Colored Cement">Colored Cement</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="test_method" class="form-label">Test Method *</label>
                                    <select class="form-select" id="test_method" name="test_method" required>
                                        <option value="">-- Select Test Method --</option>
                                        <option value="IS 4031 (Part 1) - 1996">IS 4031 (Part 1) - 1996</option>
                                        <option value="IS 4031 (Part 2) - 1999">IS 4031 (Part 2) - 1999</option>
                                        <option value="IS 4031 (Part 3) - 1988">IS 4031 (Part 3) - 1988</option>
                                        <option value="IS 4031 (Part 4) - 1988">IS 4031 (Part 4) - 1988</option>
                                        <option value="IS 4031 (Part 5) - 1988">IS 4031 (Part 5) - 1988</option>
                                        <option value="IS 4031 (Part 6) - 1988">IS 4031 (Part 6) - 1988</option>
                                        <option value="IS 4031 (Part 7) - 1988">IS 4031 (Part 7) - 1988</option>
                                        <option value="IS 4031 (Part 8) - 1988">IS 4031 (Part 8) - 1988</option>
                                        <option value="IS 4031 (Part 9) - 1988">IS 4031 (Part 9) - 1988</option>
                                        <option value="IS 4031 (Part 10) - 1988">IS 4031 (Part 10) - 1988</option>
                                        <option value="IS 4031 (Part 11) - 1988">IS 4031 (Part 11) - 1988</option>
                                        <option value="IS 4031 (Part 12) - 1988">IS 4031 (Part 12) - 1988</option>
                                        <option value="IS 4031 (Part 13) - 1988">IS 4031 (Part 13) - 1988</option>
                                        <option value="IS 4031 (Part 14) - 1988">IS 4031 (Part 14) - 1988</option>
                                        <option value="IS 4031 (Part 15) - 1988">IS 4031 (Part 15) - 1988</option>
                                        <option value="IS 4031 (Part 16) - 1988">IS 4031 (Part 16) - 1988</option>
                                        <option value="ASTM C150">ASTM C150</option>
                                        <option value="ASTM C595">ASTM C595</option>
                                        <option value="BS EN 197-1">BS EN 197-1</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="sample_test_code" class="form-label">Sample Test Code Number *</label>
                                    <input type="text" class="form-control" id="sample_test_code" name="sample_test_code" placeholder="e.g., SCN-2024001" required>
                                </div>
                                <div class="mb-3">
                                    <label for="date_of_testing" class="form-label">Date of Testing *</label>
                                    <input type="date" class="form-control" id="date_of_testing" name="date_of_testing" required>
                                </div>
                                <div class="mb-3">
                                    <label for="cement_grade" class="form-label">Grade of Cement *</label>
                                    <select class="form-select" id="cement_grade" name="cement_grade" required>
                                        <option value="">-- Select Grade --</option>
                                        <option value="33 Grade">33 Grade</option>
                                        <option value="43 Grade">43 Grade</option>
                                        <option value="53 Grade">53 Grade</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="environmental_conditions" class="form-label">Environmental Conditions</label>
                                    <input type="text" class="form-control" id="environmental_conditions" name="environmental_conditions" placeholder="e.g., Laboratory Conditions, Temperature: 27±2°C, RH: 65±5%">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Results Table -->
        <div class="row mb-4">
            <div class="col-12">
                                 <div class="card">
                     <div class="card-header">
                         <h5 class="mb-0" style="font-size: 1.5rem; text-align: left;"><i class="fas fa-table me-2"></i>Test Results</h5>
                     </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm" style="font-size: 0.875rem; table-layout: fixed;">
                                <thead class="table-dark">
                                    <tr>
                                        <th style="width: 50%; text-align: center; padding: 8px; vertical-align: middle; font-size: 1.1rem; font-weight: bold; text-align: center !important;">Number of Tests</th>
                                        <th style="width: 10%; text-align: center; padding: 8px; vertical-align: middle; font-size: 1.1rem; font-weight: bold;">01</th>
                                        <th style="width: 10%; text-align: center; padding: 8px; vertical-align: middle; font-size: 1.1rem; font-weight: bold;">02</th>
                                        <th style="width: 10%; text-align: center; padding: 8px; vertical-align: middle; font-size: 1.1rem; font-weight: bold; text-align: center !important;">03</th>
                                        <th style="width: 10%; text-align: center; padding: 8px; vertical-align: middle; font-size: 1.1rem; font-weight: bold; text-align: center !important;">04</th>
                                        <th style="width: 10%; text-align: center; padding: 8px; vertical-align: middle; font-size: 1.1rem; font-weight: bold;">05</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="vertical-align: middle; padding: 8px; text-align: left !important; padding-left: 8px !important;">(A) Distance between the indicator points keeping @ 27 ± 2°C for 24 hours (mm)</td>
                                        <td><input type="number" class="form-control form-control-sm" name="distance_27c_01" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()"></td>
                                        <td><input type="number" class="form-control form-control-sm" name="distance_27c_02" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()"></td>
                                        <td><input type="number" class="form-control form-control-sm" name="distance_27c_03" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()"></td>
                                        <td><input type="number" class="form-control form-control-sm" name="distance_27c_04" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()"></td>
                                        <td><input type="number" class="form-control form-control-sm" name="distance_27c_05" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()"></td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align: middle; padding: 8px; text-align: left !important; padding-left: 8px !important;">(B) Distance between the indicator points after boiler for 3 hours (mm)</td>
                                        <td><input type="number" class="form-control form-control-sm" name="distance_boiler_01" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()"></td>
                                        <td><input type="number" class="form-control form-control-sm" name="distance_boiler_02" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()"></td>
                                        <td><input type="number" class="form-control form-control-sm" name="distance_boiler_03" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()"></td>
                                        <td><input type="number" class="form-control form-control-sm" name="distance_boiler_04" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()"></td>
                                        <td><input type="number" class="form-control form-control-sm" name="distance_boiler_05" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()"></td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align: middle; padding: 8px; text-align: left !important; padding-left: 8px !important;">Expansion of Cement (B - A) (mm)</td>
                                        <td><input type="number" class="form-control form-control-sm" name="expansion_01" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()" readonly></td>
                                        <td><input type="number" class="form-control form-control-sm" name="expansion_02" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()" readonly></td>
                                        <td><input type="number" class="form-control form-control-sm" name="expansion_03" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()" readonly></td>
                                        <td><input type="number" class="form-control form-control-sm" name="expansion_04" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()" readonly></td>
                                        <td><input type="number" class="form-control form-control-sm" name="expansion_05" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateSoundnessAverages()" readonly></td>
                                    </tr>
                                    <!-- Average Row -->
                                    <tr class="table-secondary">
                                        <td class="text-end fw-bold" style="font-size: 1.2rem;">Average Soundness of Cement</td>
                                        <td colspan="5" class="text-center fw-bold">
                                            <input type="number" class="form-control form-control-sm" id="avg_soundness" name="avg_soundness" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" readonly>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Verification Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-user-check me-2"></i>Verification</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <h6 class="text-white mb-3">Tested By:</h6>
                                <div class="mb-3">
                                    <label for="tested_by_name" class="form-label">Name *</label>
                                    <input type="text" class="form-control" id="tested_by_name" name="tested_by_name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="tested_by_date" class="form-label">Date *</label>
                                    <input type="date" class="form-control" id="tested_by_date" name="tested_by_date" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <h6 class="text-white mb-3">Checked By:</h6>
                                <div class="mb-3">
                                    <label for="checked_by_name" class="form-label">Name *</label>
                                    <input type="text" class="form-control" id="checked_by_name" name="checked_by_name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="checked_by_date" class="form-label">Date *</label>
                                    <input type="date" class="form-control" id="checked_by_date" name="checked_by_date" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <h6 class="text-white mb-3">Verified By:</h6>
                                <div class="mb-3">
                                    <label for="verified_by_name" class="form-label">Name</label>
                                    <input type="text" class="form-control" id="verified_by_name" name="verified_by_name" value="Prakarsh A Sangave" readonly>
                                </div>
                                <div class="mb-3">
                                    <label for="verified_by_date" class="form-label">Date *</label>
                                    <input type="date" class="form-control" id="verified_by_date" name="verified_by_date" required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Remarks Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-comment me-2"></i>Remarks</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="remarks" class="form-label">Additional Remarks</label>
                            <textarea class="form-control" id="remarks" name="remarks" rows="4" placeholder="Enter any additional remarks or observations..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reviewed By and Authorized By Section -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-user-check me-2"></i>Reviewed By</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="reviewed_by" class="form-label">Select Reviewer:</label>
                            <select class="form-select" id="reviewed_by" name="reviewed_by">
                                <option value="Lalita S. Dussa - Quality Manager" selected>Lalita S. Dussa - Quality Manager</option>
                                <option value="Other Reviewer">Other Reviewer</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-user-lock me-2"></i>Authorized By</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="authorized_by" class="form-label">Authorized By:</label>
                            <input type="text" class="form-control" id="authorized_by" name="authorized_by" value="Prakarsh Sangave" readonly>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="row">
            <div class="col-12 text-center">
                <a href="{{ url_for('other_services') }}" class="btn btn-dark btn-lg me-3">
                    <i class="fas fa-times me-2"></i>Cancel
                </a>
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save me-2"></i>Save and Next
                </button>
            </div>
        </div>
    </form>
</div>

<style>
.card {
    transition: transform 0.2s ease-in-out;
}

.card:hover {
    transform: translateY(-2px);
}

.form-check-input:checked {
    background-color: #6c757d;
    border-color: #6c757d;
}

.form-check-input:focus {
    border-color: #6c757d;
    box-shadow: 0 0 0 0.25rem rgba(108, 117, 125, 0.25);
}
</style>

<script>
        // Set current date for verification section
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            
            // Set current date for all verification date fields
            const dateFields = [
                'tested_by_date',
                'checked_by_date', 
                'verified_by_date'
            ];
            
            dateFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && !field.value) {
                    field.value = today;
                }
            });
        });

        // Calculate averages function for Soundness of Cement tests
        function calculateSoundnessAverages() {
            // Calculate expansion for each test (B - A)
            for (let i = 1; i <= 5; i++) {
                let distance27c = parseFloat(document.querySelector(`input[name="distance_27c_0${i}"]`).value) || 0;
                let distanceBoiler = parseFloat(document.querySelector(`input[name="distance_boiler_0${i}"]`).value) || 0;
                let expansion = distanceBoiler - distance27c;
                document.querySelector(`input[name="expansion_0${i}"]`).value = expansion.toFixed(2);
            }
            
            // Calculate average of all expansion values
            let totalExpansion = 0;
            let validTests = 0;
            
            for (let i = 1; i <= 5; i++) {
                let expansion = parseFloat(document.querySelector(`input[name="expansion_0${i}"]`).value) || 0;
                if (expansion !== 0) {
                    totalExpansion += expansion;
                    validTests++;
                }
            }
            
            let avgSoundness = validTests > 0 ? totalExpansion / validTests : 0;
            document.querySelector('input[name="avg_soundness"]').value = avgSoundness.toFixed(2);
        }

        // Form validation
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();
</script>
{% endblock %}
