{% extends "base.html" %}

{% block title %}Fine Aggregate Testing - Form 1{% endblock %}

{% block head %}
<style>
    .auto-calculated {
        background-color: #f8f9fa !important;
        color: #6c757d !important;
        cursor: not-allowed !important;
    }
    
    .auto-calculated:focus {
        box-shadow: none !important;
        border-color: #ced4da !important;
    }
    
    /* Ensure input fields are accessible */
    input[type="number"] {
        pointer-events: auto !important;
        user-select: auto !important;
        -webkit-user-select: auto !important;
        -moz-user-select: auto !important;
        -ms-user-select: auto !important;
    }
    
    /* Specific styling for loose weight inputs */
    .loose-weight-input {
        background-color: white !important;
        color: #000 !important;
        cursor: text !important;
        pointer-events: auto !important;
    }
    
    .loose-weight-input:focus {
        background-color: white !important;
        border-color: #007bff !important;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25) !important;
    }
    
    /* Center align ALL table content - More specific and forceful */
    .table td,
    .table td *,
    .table input,
    .table strong,
    .table .form-control {
        text-align: center !important;
        vertical-align: middle !important;
    }
    
    .table th,
    .table th * {
        text-align: center !important;
        vertical-align: middle !important;
    }
    
    /* Specifically target the column headers 01, 02, 03 */
    .table thead th {
        text-align: center !important;
        text-align-last: center !important;
    }
    
    /* Force center alignment for the specific column headers */
    .table thead th:nth-child(2),
    .table thead th:nth-child(3),
    .table thead th:nth-child(4) {
        text-align: center !important;
        text-align-last: center !important;
    }
    
    /* Force center alignment for the first header (Number of Tests) */
    .table thead th:first-child {
        text-align: center !important;
        text-align-last: center !important;
    }
    
    /* Override any inline styles */
    .table td[style*="text-align"] {
        text-align: center !important;
    }
    
    .table td[style*="text-align-last"] {
        text-align-last: center !important;
    }
    
    /* Force center alignment for all table elements */
    .table * {
        text-align: center !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="h3 mb-0"><i class="fas fa-sand me-2"></i>Fine Aggregate Testing - 1</h1>
                            <p class="mb-0">Determination of Bulk Density of Aggregate (Rodded & Loose)</p>
                        </div>
                        <div>
                            <a href="{{ url_for('other_services') }}" class="btn btn-warning me-2">
                                <i class="fas fa-arrow-left me-2"></i>Back to Other Services
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <form method="POST" class="needs-validation" novalidate>
        {{ form.hidden_tag() }}
        
        <!-- Form Navigation Buttons -->
        <div class="row mb-2">
            <div class="col-12">
                <div class="card">
                    <div class="card-body py-2">
                        <div class="d-flex justify-content-center">
                            <a href="{{ url_for('fine_aggregate_form_1') }}" class="btn btn-primary active btn-lg me-5" style="font-size: 1.5rem; font-weight: bold; width: 80px; height: 80px; border-radius: 50%; margin-right: 5rem !important; display: flex; align-items: center; justify-content: center;">
                                1
                            </a>
                            <a href="{{ url_for('fine_aggregate_form_2') }}" class="btn btn-outline-primary btn-lg mx-5" style="font-size: 1.5rem; font-weight: bold; width: 80px; height: 80px; border-radius: 50%; margin-left: 5rem !important; margin-right: 5rem !important; display: flex; align-items: center; justify-content: center;">
                                2
                            </a>
                            <a href="{{ url_for('fine_aggregate_form_3') }}" class="btn btn-outline-primary btn-lg ms-5" style="font-size: 1.5rem; font-weight: bold; width: 80px; height: 80px; border-radius: 50%; margin-left: 5rem !important; display: flex; align-items: center; justify-content: center;">
                                3
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- General Information -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>General Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="customer_id" class="form-label">Customer Name *</label>
                                    <select class="form-select" id="customer_id" name="customer_id" required>
                                        <option value="">-- Select Customer --</option>
                                        {% for customer in customers %}
                                        <option value="{{ customer.id }}">{{ customer.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="sample_description" class="form-label">Sample Description *</label>
                                    <textarea class="form-control" id="sample_description" name="sample_description" rows="3" placeholder="Describe the sample..." required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="date_of_receipt" class="form-label">Date of Receipt *</label>
                                    <input type="date" class="form-control" id="date_of_receipt" name="date_of_receipt" required>
                                </div>
                                <div class="mb-3">
                                    <label for="type_size_aggregate" class="form-label">Type & Size of Aggregate *</label>
                                    <input type="text" class="form-control" id="type_size_aggregate" name="type_size_aggregate" placeholder="e.g., Fine Aggregate, 4.75mm down" required>
                                </div>
                                <div class="mb-3">
                                    <label for="test_method" class="form-label">Test Method *</label>
                                    <select class="form-select" id="test_method" name="test_method" required>
                                        <option value="">-- Select Test Method --</option>
                                        <option value="IS 2386 (Part III) - 1963">IS 2386 (Part III) - 1963</option>
                                        <option value="ASTM C29/C29M">ASTM C29/C29M</option>
                                        <option value="BS 812-2:1995">BS 812-2:1995</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="sample_test_code" class="form-label">Sample Test Code Number *</label>
                                    <input type="text" class="form-control" id="sample_test_code" name="sample_test_code" placeholder="e.g., SCN-2024001" required>
                                </div>
                                <div class="mb-3">
                                    <label for="date_of_testing" class="form-label">Date of Testing *</label>
                                    <input type="date" class="form-control" id="date_of_testing" name="date_of_testing" required>
                                </div>
                                <div class="mb-3">
                                    <label for="condition_of_aggregate" class="form-label">Condition of Aggregate *</label>
                                    <select class="form-select" id="condition_of_aggregate" name="condition_of_aggregate" required>
                                        <option value="">-- Select Condition --</option>
                                        <option value="Dry">Dry</option>
                                        <option value="Saturated Surface Dry (SSD)">Saturated Surface Dry (SSD)</option>
                                        <option value="Wet">Wet</option>
                                        <option value="Air Dried">Air Dried</option>
                                        <option value="Oven Dried">Oven Dried</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="environmental_conditions" class="form-label">Environmental Conditions</label>
                                    <input type="text" class="form-control" id="environmental_conditions" name="environmental_conditions" placeholder="e.g., Laboratory Conditions, Temperature: 27±2°C">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Report Details -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Test Report Details</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="date_of_report" class="form-label">Date of Report</label>
                                    <input type="date" class="form-control" id="date_of_report" name="date_of_report">
                                </div>
                                <div class="mb-3">
                                    <label for="reference_number" class="form-label">Reference Number</label>
                                    <input type="text" class="form-control" id="reference_number" name="reference_number" placeholder="Enter reference number">
                                </div>
                                <div class="mb-3">
                                    <label for="date_of_material_receipt" class="form-label">Date of Material Receipt</label>
                                    <input type="date" class="form-control" id="date_of_material_receipt" name="date_of_material_receipt">
                                </div>
                                <div class="mb-3">
                                    <label for="material_description" class="form-label">Material Description</label>
                                    <textarea class="form-control" id="material_description" name="material_description" rows="2" placeholder="Detailed description of the material"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="location_of_testing" class="form-label">Location of Testing</label>
                                    <input type="text" class="form-control" id="location_of_testing" name="location_of_testing" placeholder="e.g., Laboratory, Site, etc.">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="url_number" class="form-label">ULR Number *</label>
                                    <input type="text" class="form-control" id="url_number" name="url_number" placeholder="Enter ULR number" required>
                                </div>
                                <div class="mb-3">
                                    <label for="job_code_number" class="form-label">Job Code Number *</label>
                                    <input type="text" class="form-control" id="job_code_number" name="job_code_number" placeholder="Enter job code number" required>
                                </div>
                                <div class="mb-3">
                                    <label for="period_of_testing" class="form-label">Period of Testing</label>
                                    <input type="text" class="form-control" id="period_of_testing" name="period_of_testing" placeholder="e.g., 24 hours, 7 days">
                                </div>
                                <div class="mb-3">
                                    <label for="condition_of_sample" class="form-label">Condition of Sample</label>
                                    <select class="form-select" id="condition_of_sample" name="condition_of_sample">
                                        <option value="">-- Select Condition --</option>
                                        <option value="As Received">As Received</option>
                                        <option value="Processed">Processed</option>
                                        <option value="Prepared">Prepared</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Result -->
        <div class="row mb-4" style="border: none !important; outline: none !important;">
            <div class="col-12" style="border: none !important; outline: none !important;">
                <div style="border: none !important; box-shadow: none !important; background: transparent !important; outline: none !important; margin: 0 !important; padding: 0 !important;">
                    <div style="border: none !important; background: transparent !important; padding: 10px 0; outline: none !important;">
                        <h5 class="mb-0"><i class="fas fa-table me-2"></i>Test Result</h5>
                        <small class="text-muted"><i class="fas fa-info-circle me-1"></i>Fields marked with light gray background are auto-calculated. Mean values are simple averages of the three test results.</small>
                    </div>
                    <div style="border: none !important; padding: 8px; background: transparent !important; outline: none !important;">
                        <div class="table-responsive">
                            <table class="table table-striped" style="font-size: 1.1rem; margin-bottom: 0; table-layout: fixed; width: 100%; border: none !important; border-collapse: collapse; border-spacing: 0; --bs-table-border-color: transparent !important; outline: none !important; box-shadow: none !important;">
                                <thead class="table-dark">
                                    <tr>
                                        <th style="width: 550px; padding: 6px; border-right: 1px solid white !important; outline: none !important; font-size: 1.3rem;">Number of Tests</th>
                                        <th style="width: 140px; padding: 4px; text-align: center; text-align-last: center; vertical-align: middle; border-right: 1px solid white !important; outline: none !important; font-size: 1.3rem;">01</th>
                                        <th style="width: 140px; padding: 4px; text-align: center; text-align-last: center; vertical-align: middle; border-right: 1px solid white !important; outline: none !important; font-size: 1.3rem;">02</th>
                                        <th style="width: 140px; padding: 4px; text-align: center; text-align-last: center; vertical-align: middle; outline: none !important; font-size: 1.3rem;">03</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="font-size: 1rem; padding: 6px; padding-left: 12px;"><strong>Volume of measure cylinder used for determination of bulk density (lit.)</strong></td>
                                        <td style="width: 140px; padding: 4px;"><input type="number" id="volume_01" class="form-control form-control-sm volume-input" step="0.01" style="height: 30px;"></td>
                                        <td style="width: 140px; padding: 4px;"><input type="number" id="volume_02" class="form-control form-control-sm volume-input" step="0.01" style="height: 30px;"></td>
                                        <td style="width: 140px; padding: 4px;" class="text-center"><input type="number" id="volume_03" class="form-control form-control-sm volume-input" step="0.01" style="height: 30px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="font-size: 1rem; padding: 6px; padding-left: 12px;"><strong>Net weight of Rodded Sample in the measure cylinder (kg)</strong></td>
                                        <td style="width: 60px; padding: 4px;"><input type="number" id="rodded_weight_01" class="form-control form-control-sm rodded-weight-input" step="0.001" style="height: 30px;"></td>
                                        <td style="width: 60px; padding: 4px;"><input type="number" id="rodded_weight_02" class="form-control form-control-sm rodded-weight-input" step="0.001" style="height: 30px;"></td>
                                        <td style="width: 60px; padding: 4px;" class="text-center"><input type="number" id="rodded_weight_03" class="form-control form-control-sm rodded-weight-input" step="0.001" style="height: 30px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="font-size: 1rem; padding: 6px; padding-left: 12px;"><strong>Rodded Bulk Density (kg/lit.) <i class="fas fa-calculator text-info" title="Auto-calculated field"></i></strong></td>
                                        <td style="width: 140px; padding: 4px;"><input type="number" id="rodded_density_01" class="form-control form-control-sm auto-calculated" step="0.001" style="height: 30px;" readonly></td>
                                        <td style="width: 140px; padding: 4px;"><input type="number" id="rodded_density_02" class="form-control form-control-sm auto-calculated" step="0.001" style="height: 30px;" readonly></td>
                                        <td style="width: 140px; padding: 4px;" class="text-center"><input type="number" id="rodded_density_03" class="form-control form-control-sm auto-calculated" step="0.001" style="height: 30px;" readonly></td>
                                    </tr>
                                    <tr class="table-info">
                                        <td style="font-size: 1rem; padding: 6px; text-align: center;"><strong>Mean Rodded Bulk Density (kg/lit.) <i class="fas fa-calculator text-info" title="Auto-calculated field"></i></strong></td>
                                        <td colspan="3" style="padding: 6px;"><input type="number" id="mean_rodded_density" class="form-control form-control-sm auto-calculated" step="0.001" style="height: 30px;" readonly></td>
                                    </tr>
                                    <tr>
                                        <td style="font-size: 1rem; padding: 6px; padding-left: 12px;"><strong>Net weight of Loose Sample in the measure cylinder (kg)</strong></td>
                                        <td style="width: 140px; padding: 4px;"><input type="number" id="loose_weight_01" class="form-control form-control-sm loose-weight-input" step="0.001" style="height: 30px;"></td>
                                        <td style="width: 140px; padding: 4px;"><input type="number" id="loose_weight_02" class="form-control form-control-sm loose-weight-input" step="0.001" style="height: 30px;"></td>
                                        <td style="width: 140px; padding: 4px;" class="text-center"><input type="number" id="loose_weight_03" class="form-control form-control-sm loose-weight-input" step="0.001" style="height: 30px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="font-size: 1rem; padding: 6px; padding-left: 12px;"><strong>Loose Bulk Density (kg/lit.) <i class="fas fa-calculator text-info" title="Auto-calculated field"></i></strong></td>
                                        <td style="width: 140px; padding: 4px;"><input type="number" id="loose_density_01" class="form-control form-control-sm auto-calculated" step="0.001" style="height: 30px;" readonly></td>
                                        <td style="width: 140px; padding: 4px;"><input type="number" id="loose_density_02" class="form-control form-control-sm auto-calculated" step="0.001" style="height: 30px;" readonly></td>
                                        <td style="width: 140px; padding: 4px;" class="text-center"><input type="number" id="loose_density_03" class="form-control form-control-sm auto-calculated" step="0.001" style="height: 30px;" readonly></td>
                                    </tr>
                                    <tr class="table-info">
                                        <td style="font-size: 1rem; padding: 6px; text-align: center;"><strong>Mean Loose Bulk Density (kg/lit.) <i class="fas fa-calculator text-info" title="Auto-calculated field"></i></strong></td>
                                        <td colspan="3" style="padding: 6px;"><input type="number" id="mean_loose_density" class="form-control form-control-sm auto-calculated" step="0.001" style="height: 30px;" readonly></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Verification -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-user-check me-2"></i>Verification</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <h6>Tested By</h6>
                                <div class="mb-3">
                                    <label for="tested_by_name" class="form-label">Name *</label>
                                    <input type="text" class="form-control" id="tested_by_name" name="tested_by_name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="tested_by_date" class="form-label">Date *</label>
                                    <input type="date" class="form-control" id="tested_by_date" name="tested_by_date" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <h6>Checked By</h6>
                                <div class="mb-3">
                                    <label for="checked_by_name" class="form-label">Name *</label>
                                    <input type="text" class="form-control" id="checked_by_name" name="checked_by_name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="checked_by_date" class="form-label">Date *</label>
                                    <input type="date" class="form-control" id="checked_by_date" name="checked_by_date" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <h6>Verified By</h6>
                                <div class="mb-3">
                                    <label for="verified_by_name" class="form-label">Name</label>
                                    <input type="text" class="form-control" id="verified_by_name" name="verified_by_name" value="Prakarsh A Sangave" readonly style="background-color: rgba(108, 117, 125, 0.1); border-color: #495057; opacity: 0.9;">
                                </div>
                                <div class="mb-3">
                                    <label for="verified_by_date" class="form-label">Date *</label>
                                    <input type="date" class="form-control" id="verified_by_date" name="verified_by_date" required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Remarks -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-comment me-2"></i>Remarks</h5>
                    </div>
                    <div class="card-body">
                        <textarea class="form-control" id="remarks" name="remarks" rows="4" placeholder="Enter any additional remarks or observations..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reviewed By and Authorized By Section -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-user-check me-2"></i>Reviewed By</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="reviewed_by" class="form-label">Select Reviewer:</label>
                            <select class="form-select" id="reviewed_by" name="reviewed_by" required>
                                <option value="">-- Select a reviewer --</option>
                                <option value="Lalita S. Dussa - Quality Manager" data-name="Lalita S. Dussa" data-designation="Quality Manager" data-graduation="B.Tech.(Civil)" selected>Lalita S. Dussa - Quality Manager</option>
                                <option value="Prakarsha A. Sangave - Quality Manager" data-name="Prakarsha A. Sangave" data-designation="Quality Manager" data-graduation="B.Tech.(Civil)">Prakarsha A. Sangave - Quality Manager</option>
                                <option value="Harsha Prakarsha Sangave - Quality Manager" data-name="Harsha Prakarsha Sangave" data-designation="Quality Manager" data-graduation="B.Tech.(Civil)">Harsha Prakarsha Sangave - Quality Manager</option>
                                <option value="Amol A Adam - Quality Manager" data-name="Amol A Adam" data-designation="Quality Manager" data-graduation="B.Tech.(Civil)">Amol A Adam - Quality Manager</option>
                                <option value="Aaquib J. Shaikh - Quality Manager" data-name="Aaquib J. Shaikh" data-designation="Quality Manager" data-graduation="B.Tech.(Civil)">Aaquib J. Shaikh - Quality Manager</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-user-shield me-2"></i>Authorized By</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="authorized_by" class="form-label">Authorized By:</label>
                            <input type="text" class="form-control" id="authorized_by" name="authorized_by" value="Prakarsh Sangave" readonly style="background-color: rgba(108, 117, 125, 0.1); border-color: #495057; opacity: 0.9;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="row">
            <div class="col-12 text-center">
                <div class="d-grid gap-2 d-md-block">
                    <a href="{{ url_for('other_services') }}" class="btn btn-secondary btn-lg me-md-2">
                        <i class="fas fa-times me-2"></i>Cancel
                    </a>
                    <button type="submit" class="btn btn-primary btn-lg me-md-2">
                        <i class="fas fa-save me-2"></i>Save and Next
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set default dates to today
    const today = new Date().toISOString().split('T')[0];
    
    // Set default dates for date fields
    const dateFields = [
        'date_of_receipt',
        'date_of_testing',
        'date_of_report',
        'date_of_material_receipt',
        'tested_by_date',
        'checked_by_date',
        'verified_by_date'
    ];
    
    dateFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field && !field.value) {
            field.value = today;
        }
    });
    
    // Handle Save and Next button click
    const saveAndNextBtn = document.querySelector('button[type="submit"]');
    if (saveAndNextBtn) {
        saveAndNextBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Navigate to next form immediately
            window.location.href = "{{ url_for('fine_aggregate_form_2') }}";
        });
    }

    // Auto-calculate Rodded Bulk Density
    function calculateRoddedBulkDensity() {
        // Get inputs by specific IDs
        const volume01 = document.getElementById('volume_01');
        const volume02 = document.getElementById('volume_02');
        const volume03 = document.getElementById('volume_03');
        
        const weight01 = document.getElementById('rodded_weight_01');
        const weight02 = document.getElementById('rodded_weight_02');
        const weight03 = document.getElementById('rodded_weight_03');
        
        // Get bulk density inputs by specific IDs
        const bulkDensity01 = document.getElementById('rodded_density_01');
        const bulkDensity02 = document.getElementById('rodded_density_02');
        const bulkDensity03 = document.getElementById('rodded_density_03');
        
        // Calculate and update bulk density values
        function updateBulkDensity(volumeInput, weightInput, bulkDensityInput) {
            if (volumeInput && weightInput && bulkDensityInput) {
                // Ensure we're only updating output fields, not input fields
                if (bulkDensityInput.classList.contains('auto-calculated')) {
                    const volume = parseFloat(volumeInput.value) || 0;
                    const weight = parseFloat(weightInput.value) || 0;
                    
                    if (volume > 0 && weight > 0) {
                        const bulkDensity = weight / volume;
                        bulkDensityInput.value = bulkDensity.toFixed(3);
                    } else {
                        bulkDensityInput.value = '';
                    }
                }
            }
        }
        
        // Update each column
        updateBulkDensity(volume01, weight01, bulkDensity01);
        updateBulkDensity(volume02, weight02, bulkDensity02);
        updateBulkDensity(volume03, weight03, bulkDensity03);
        
        // Calculate mean rodded bulk density
        calculateMeanRoddedBulkDensity();
    }
    
    // Auto-calculate Loose Bulk Density
    function calculateLooseBulkDensity() {
        // Get inputs by specific IDs
        const volume01 = document.getElementById('volume_01');
        const volume02 = document.getElementById('volume_02');
        const volume03 = document.getElementById('volume_03');
        
        const looseWeight01 = document.getElementById('loose_weight_01');
        const looseWeight02 = document.getElementById('loose_weight_02');
        const looseWeight03 = document.getElementById('loose_weight_03');
        

        
        // Get loose bulk density inputs by specific IDs
        const looseBulkDensity01 = document.getElementById('loose_density_01');
        const looseBulkDensity02 = document.getElementById('loose_density_02');
        const looseBulkDensity03 = document.getElementById('loose_density_03');
        
        // Calculate and update loose bulk density values
        function updateLooseBulkDensity(volumeInput, weightInput, bulkDensityInput) {
            if (volumeInput && weightInput && bulkDensityInput) {
                // Ensure we're only updating output fields, not input fields
                if (bulkDensityInput.classList.contains('auto-calculated')) {
                    const volume = parseFloat(volumeInput.value) || 0;
                    const weight = parseFloat(weightInput.value) || 0;
                    
                    if (volume > 0 && weight > 0) {
                        const bulkDensity = weight / volume;
                        bulkDensityInput.value = bulkDensity.toFixed(3);
                    } else {
                        bulkDensityInput.value = '';
                    }
                }
            }
        }
        
        // Update each column
        updateLooseBulkDensity(volume01, looseWeight01, looseBulkDensity01);
        updateLooseBulkDensity(volume02, looseWeight02, looseBulkDensity02);
        updateLooseBulkDensity(volume03, looseWeight03, looseBulkDensity03);
        
        // Calculate mean loose bulk density
        calculateMeanLooseBulkDensity();
    }
    
    // Calculate mean rodded bulk density
    function calculateMeanRoddedBulkDensity() {
        const bulkDensity01 = document.getElementById('rodded_density_01');
        const bulkDensity02 = document.getElementById('rodded_density_02');
        const bulkDensity03 = document.getElementById('rodded_density_03');
        
        // Get the mean input field by ID
        const meanInput = document.getElementById('mean_rodded_density');
        
        const values = [
            parseFloat(bulkDensity01.value) || 0,
            parseFloat(bulkDensity02.value) || 0,
            parseFloat(bulkDensity03.value) || 0
        ].filter(val => val > 0);
        
        if (values.length > 0) {
            const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
            meanInput.value = mean.toFixed(3);
        } else {
            meanInput.value = '';
        }
    }
    
    // Calculate mean loose bulk density
    function calculateMeanLooseBulkDensity() {
        const looseBulkDensity01 = document.getElementById('loose_density_01');
        const looseBulkDensity02 = document.getElementById('loose_density_02');
        const looseBulkDensity03 = document.getElementById('loose_density_03');
        
        // Get the mean input field by ID
        const meanInput = document.getElementById('mean_loose_density');
        
        const values = [
            parseFloat(looseBulkDensity01.value) || 0,
            parseFloat(looseBulkDensity02.value) || 0,
            parseFloat(looseBulkDensity03.value) || 0
        ].filter(val => val > 0);
        
        if (values.length > 0) {
            const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
            meanInput.value = mean.toFixed(3);
        } else {
            meanInput.value = '';
        }
    }
    
    // Add event listeners to volume and weight inputs
    function addCalculationListeners() {
        const allInputs = document.querySelectorAll('input[type="number"]');
        
        allInputs.forEach((input) => {
            input.addEventListener('input', function() {
                calculateRoddedBulkDensity();
                calculateLooseBulkDensity();
            });
        });
    }

    // Initial calculation on page load
    calculateRoddedBulkDensity();
    calculateLooseBulkDensity();
    addCalculationListeners();
    

});
</script>
{% endblock %}
