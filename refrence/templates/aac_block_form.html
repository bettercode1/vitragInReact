{% extends 'base.html' %}

{% block title %}AAC Block - Compressive Strength Test{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                                                 <div>
                             <h1 class="h3 mb-0"><i class="fas fa-cube me-2"></i>Determination of Compressive Strength of AAC Block</h1>
                             <p class="mb-0 mt-2">This test is conducted to determine the compressive strength of AAC Blocks</p>
                         </div>
                        <a href="{{ url_for('other_services') }}" class="btn btn-light">
                            <i class="fas fa-arrow-left me-2"></i>Back to Other Services
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <form method="POST" action="{{ url_for('aac_block_form') }}">
        {{ form.hidden_tag() }}
        
        <!-- SECTION 1: General Information -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                                         <div class="card-header">
                         <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>General Information</h5>
                     </div>
                                         <div class="card-body">
                         <div class="row">
                             <div class="col-md-6">
                                 <div class="mb-3">
                                     <label for="customer_id" class="form-label">Customer *</label>
                                     <select class="form-select" id="customer_id" name="customer_id" required>
                                         <option value="">--Select Customer--</option>
                                         {% for customer in customers %}
                                         <option value="{{ customer.id }}">{{ customer.name }}</option>
                                         {% endfor %}
                                     </select>
                                 </div>
                                 <div class="mb-3">
                                     <label for="{{ form.sample_description.id }}" class="form-label">{{ form.sample_description.label }} *</label>
                                     {{ form.sample_description(class="form-control", rows="3", placeholder="Describe the sample...") }}
                                     {% if form.sample_description.errors %}
                                     <div class="text-danger small">{{ form.sample_description.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                                 <div class="mb-3">
                                     <label for="{{ form.date_of_receipt.id }}" class="form-label">{{ form.date_of_receipt.label }} *</label>
                                     {{ form.date_of_receipt(class="form-control", type="date") }}
                                     {% if form.date_of_receipt.errors %}
                                     <div class="text-danger small">{{ form.date_of_receipt.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                                 <div class="mb-3">
                                     <label for="{{ form.customer_site_name_address.id }}" class="form-label">{{ form.customer_site_name_address.label }} *</label>
                                     {{ form.customer_site_name_address(class="form-control", rows="3", placeholder="Enter customer/site name and address") }}
                                     {% if form.customer_site_name_address.errors %}
                                     <div class="text-danger small">{{ form.customer_site_name_address.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                                 <div class="mb-3">
                                     <label for="{{ form.reference_number.id }}" class="form-label">{{ form.reference_number.label }}</label>
                                     {{ form.reference_number(class="form-control", placeholder="Enter reference number") }}
                                     {% if form.reference_number.errors %}
                                     <div class="text-danger small">{{ form.reference_number.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                             </div>
                             <div class="col-md-6">
                                 <div class="mb-3">
                                     <label for="{{ form.date_of_manufacturer.id }}" class="form-label">{{ form.date_of_manufacturer.label }}</label>
                                     {{ form.date_of_manufacturer(class="form-control", type="date") }}
                                     {% if form.date_of_manufacturer.errors %}
                                     <div class="text-danger small">{{ form.date_of_manufacturer.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                                 <div class="mb-3">
                                     <label for="{{ form.type_of_specimen.id }}" class="form-label">{{ form.type_of_specimen.label }} *</label>
                                     {{ form.type_of_specimen(class="form-control", placeholder="e.g., AAC Block") }}
                                     {% if form.type_of_specimen.errors %}
                                     <div class="text-danger small">{{ form.type_of_specimen.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                                 <div class="mb-3">
                                     <label for="{{ form.machine_used_for_testing.id }}" class="form-label">{{ form.machine_used_for_testing.label }} *</label>
                                     {{ form.machine_used_for_testing(class="form-control", placeholder="e.g., Compression Testing Machine") }}
                                     {% if form.machine_used_for_testing.errors %}
                                     <div class="text-danger small">{{ form.machine_used_for_testing.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                                 <div class="mb-3">
                                     <label for="{{ form.location_of_test.id }}" class="form-label">{{ form.location_of_test.label }} *</label>
                                     {{ form.location_of_test(class="form-control", placeholder="e.g., Laboratory, Site, etc.") }}
                                     {% if form.location_of_test.errors %}
                                     <div class="text-danger small">{{ form.location_of_test.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                                 <div class="mb-3">
                                     <label for="{{ form.capacity_range.id }}" class="form-label">{{ form.capacity_range.label }} *</label>
                                     {{ form.capacity_range(class="form-control", placeholder="e.g., 2000 kN, 0-100%") }}
                                     {% if form.capacity_range.errors %}
                                     <div class="text-danger small">{{ form.capacity_range.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                                 <div class="mb-3">
                                     <label for="{{ form.test_method.id }}" class="form-label">{{ form.test_method.label }} *</label>
                                     {{ form.test_method(class="form-control") }}
                                     {% if form.test_method.errors %}
                                     <div class="text-danger small">{{ form.test_method.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                             </div>
                         </div>
                     </div>
                </div>
            </div>
        </div>

        <!-- SECTION 2: Sample Details -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                                         <div class="card-header">
                         <h5 class="mb-0"><i class="fas fa-flask me-2"></i>Sample Details</h5>
                     </div>
                                                                                   <div class="card-body">
                          <div class="row">
                              <div class="col-md-6">
                                  <div class="mb-3">
                                      <label for="{{ form.sample_test_code.id }}" class="form-label">{{ form.sample_test_code.label }} *</label>
                                      {{ form.sample_test_code(class="form-control", placeholder="e.g., SCN-2024001") }}
                                      {% if form.sample_test_code.errors %}
                                      <div class="text-danger small">{{ form.sample_test_code.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                                  <div class="mb-3">
                                      <label for="{{ form.date_of_testing.id }}" class="form-label">{{ form.date_of_testing.label }} *</label>
                                      {{ form.date_of_testing(class="form-control", type="date") }}
                                      {% if form.date_of_testing.errors %}
                                      <div class="text-danger small">{{ form.date_of_testing.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                                  <div class="mb-3">
                                      <label for="{{ form.date_of_report.id }}" class="form-label">{{ form.date_of_report.label }} *</label>
                                      {{ form.date_of_report(class="form-control", type="date") }}
                                      {% if form.date_of_report.errors %}
                                      <div class="text-danger small">{{ form.date_of_report.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                                  <div class="mb-3">
                                      <label for="{{ form.ulr_number.id }}" class="form-label">{{ form.ulr_number.label }} *</label>
                                      {{ form.ulr_number(class="form-control", placeholder="Enter ULR number") }}
                                      {% if form.ulr_number.errors %}
                                      <div class="text-danger small">{{ form.ulr_number.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                                  <div class="mb-3">
                                      <label for="{{ form.job_code_number.id }}" class="form-label">{{ form.job_code_number.label }} *</label>
                                      {{ form.job_code_number(class="form-control", placeholder="Enter job code number") }}
                                      {% if form.job_code_number.errors %}
                                      <div class="text-danger small">{{ form.job_code_number.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                              </div>
                              <div class="col-md-6">
                                  <div class="mb-3">
                                      <label for="{{ form.manufacturer.id }}" class="form-label">{{ form.manufacturer.label }}</label>
                                      {{ form.manufacturer(class="form-control", placeholder="Enter manufacturer name") }}
                                      {% if form.manufacturer.errors %}
                                      <div class="text-danger small">{{ form.manufacturer.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                                  <div class="mb-3">
                                      <label for="{{ form.condition_of_specimen.id }}" class="form-label">{{ form.condition_of_specimen.label }}</label>
                                      {{ form.condition_of_specimen(class="form-control", placeholder="e.g., Dry, Wet, Saturated") }}
                                      {% if form.condition_of_specimen.errors %}
                                      <div class="text-danger small">{{ form.condition_of_specimen.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                                  <div class="mb-3">
                                      <label for="{{ form.calibration_due_date.id }}" class="form-label">{{ form.calibration_due_date.label }}</label>
                                      {{ form.calibration_due_date(class="form-control", type="date") }}
                                      {% if form.calibration_due_date.errors %}
                                      <div class="text-danger small">{{ form.calibration_due_date.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                                  <div class="mb-3">
                                      <label for="{{ form.environmental_condition.id }}" class="form-label">{{ form.environmental_condition.label }}</label>
                                      {{ form.environmental_condition(class="form-control", placeholder="e.g., Laboratory Conditions") }}
                                      {% if form.environmental_condition.errors %}
                                      <div class="text-danger small">{{ form.environmental_condition.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                              </div>
                          </div>
                      </div>
                </div>
            </div>
                 </div>
 
         <!-- SECTION 3: AAC Block Specific Details -->
         <div class="row mb-4">
             <div class="col-12">
                 <div class="card shadow-sm">
                     <div class="card-header">
                         <h5 class="mb-0"><i class="fas fa-cube me-2"></i>AAC Block Specific Details</h5>
                     </div>
                     <div class="card-body">
                         <div class="row">
                             <div class="col-md-6">
                                 <div class="mb-3">
                                     <label for="{{ form.quantity_of_blocks.id }}" class="form-label">{{ form.quantity_of_blocks.label }} *</label>
                                     {{ form.quantity_of_blocks(class="form-control", placeholder="e.g., 10") }}
                                     {% if form.quantity_of_blocks.errors %}
                                     <div class="text-danger small">{{ form.quantity_of_blocks.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                                 <div class="mb-3">
                                     <label for="{{ form.date_of_casting.id }}" class="form-label">{{ form.date_of_casting.label }} *</label>
                                     {{ form.date_of_casting(class="form-control", type="date") }}
                                     {% if form.date_of_casting.errors %}
                                     <div class="text-danger small">{{ form.date_of_casting.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                                 <div class="mb-3">
                                     <label for="{{ form.grade_of_blocks.id }}" class="form-label">{{ form.grade_of_blocks.label }} *</label>
                                     {{ form.grade_of_blocks(class="form-control", placeholder="e.g., Grade 3.5") }}
                                     {% if form.grade_of_blocks.errors %}
                                     <div class="text-danger small">{{ form.grade_of_blocks.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                                 <div class="mb-3">
                                     <label for="{{ form.manufacture_of_blocks.id }}" class="form-label">{{ form.manufacture_of_blocks.label }} *</label>
                                     {{ form.manufacture_of_blocks(class="form-control", placeholder="e.g., ABC Manufacturing") }}
                                     {% if form.manufacture_of_blocks.errors %}
                                     <div class="text-danger small">{{ form.manufacture_of_blocks.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                             </div>
                             <div class="col-md-6">
                                 <div class="mb-3">
                                     <label for="{{ form.blocks_condition.id }}" class="form-label">{{ form.blocks_condition.label }} *</label>
                                     {{ form.blocks_condition(class="form-control", placeholder="e.g., Dry, Wet, Saturated") }}
                                     {% if form.blocks_condition.errors %}
                                     <div class="text-danger small">{{ form.blocks_condition.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                                 <div class="mb-3">
                                     <label for="{{ form.curing_condition.id }}" class="form-label">{{ form.curing_condition.label }} *</label>
                                     {{ form.curing_condition(class="form-control", placeholder="e.g., Air cured, Water cured") }}
                                     {% if form.curing_condition.errors %}
                                     <div class="text-danger small">{{ form.curing_condition.errors[0] }}</div>
                                     {% endif %}
                                 </div>
                             </div>
                         </div>
                     </div>
                 </div>
             </div>
                  </div>
 
         <!-- SECTION 4: Test Results Table -->
         <div class="row mb-4">
             <div class="col-12">
                 <div class="card shadow-sm">
                     <div class="card-header">
                         <h5 class="mb-0"><i class="fas fa-table me-2"></i>Test Results</h5>
                     </div>
                     <div class="card-body">

                         <div class="table-responsive">
                             <table class="table table-bordered table-sm" style="font-size: 0.875rem; table-layout: fixed;">
                                 <style>
                                     /* Hide spinner buttons for L, B, H input fields */
                                     input[name^="length_"], input[name^="breadth_"], input[name^="height_"] {
                                         -webkit-appearance: none;
                                         -moz-appearance: textfield;
                                         appearance: textfield;
                                     }
                                     input[name^="length_"]::-webkit-outer-spin-button,
                                     input[name^="length_"]::-webkit-inner-spin-button,
                                     input[name^="breadth_"]::-webkit-outer-spin-button,
                                     input[name^="breadth_"]::-webkit-inner-spin-button,
                                     input[name^="height_"]::-webkit-outer-spin-button,
                                     input[name^="height_"]::-webkit-inner-spin-button {
                                         -webkit-appearance: none;
                                         margin: 0;
                                     }
                                 </style>
                                                                    <thead class="table-dark">
                                       <tr>
                                           <th style="width: 50px; min-width: 50px; max-width: 50px; text-align: center; padding: 4px 2px;">Sr. No</th>
                                           <th style="width: 90px; text-align: center;">Blocks ID</th>
                                           <th style="width: 200px; min-width: 200px; max-width: 200px; text-align: center; padding: 0; vertical-align: middle;">
                                               <div style="border-bottom: 1px solid white; padding: 8px 0; text-align: center; vertical-align: middle;">Size</div>
                                               <div style="display: flex; border-top: 1px solid white; height: 100%; position: relative;">
                                                   <div style="flex: 1; text-align: center; font-size: 0.8rem; padding: 4px 2px; display: flex; align-items: center; justify-content: center; position: relative; vertical-align: middle;">
                                                       <span style="display: flex; align-items: center; justify-content: center; height: 100%;">L (mm)</span>
                                                       <div style="position: absolute; right: 0; top: -1px; bottom: -1px; width: 1px; background-color: white;"></div>
                                                   </div>
                                                   <div style="flex: 1; text-align: center; font-size: 0.8rem; padding: 4px 2px; display: flex; align-items: center; justify-content: center; position: relative; vertical-align: middle;">
                                                       <span style="display: flex; align-items: center; justify-content: center; height: 100%;">B (mm)</span>
                                                       <div style="position: absolute; right: 0; top: -1px; bottom: -1px; width: 1px; background-color: white;"></div>
                                                   </div>
                                                   <div style="flex: 1; text-align: center; font-size: 0.8rem; padding: 4px 2px; display: flex; align-items: center; justify-content: center; vertical-align: middle;">
                                                       <span style="display: flex; align-items: center; justify-content: center; height: 100%;">H (mm)</span>
                                                   </div>
                                               </div>
                                           </th>
                                           <th style="width: 90px; text-align: center; vertical-align: middle;">Area (mm²)</th>
                                           <th style="width: 120px; text-align: center;">Block Weight (Kg)</th>
                                           <th style="width: 120px; text-align: center;">Density (Kg/m³)</th>
                                           <th style="width: 120px; text-align: center;">Load Maximum (N)</th>
                                           <th style="width: 150px; text-align: center;">Compressive Strength (Mpa)</th>
                                       </tr>
                                   </thead>
                                 <tbody>
                                                                            <tr>
                                           <td style="text-align: center; vertical-align: middle; font-weight: bold;">1</td>
                                           <td><input type="text" class="form-control form-control-sm" name="block_id_1" placeholder="Block ID" style="font-size: 0.8rem; padding: 0.25rem;"></td>
                                           <td style="padding: 0; vertical-align: middle;">
                                               <div style="display: flex; height: 100%;">
                                                   <div style="flex: 1.5; padding: 0; border-right: 1px solid #dee2e6;">
                                                       <input type="number" class="form-control form-control-sm" name="length_1" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem; border-radius: 0; border-right: none; text-align: center;" oninput="document.querySelector('input[name=\'area_1\']').value = (parseFloat(this.value) || 0) * (parseFloat(document.querySelector('input[name=\'breadth_1\']').value) || 0); document.querySelector('input[name=\'density_1\']').value = ((parseFloat(document.querySelector('input[name=\'weight_1\']').value) || 0) / ((parseFloat(this.value) || 0) * (parseFloat(document.querySelector('input[name=\'breadth_1\']').value) || 0) * (parseFloat(document.querySelector('input[name=\'height_1\']').value) || 0) / 1000000000)).toFixed(1)">
                                                   </div>
                                                   <div style="flex: 1.5; padding: 0; border-right: 1px solid #dee2e6;">
                                                       <input type="number" class="form-control form-control-sm" name="breadth_1" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem; border-radius: 0; border-right: none; text-align: center;" oninput="document.querySelector('input[name=\'area_1\']').value = (parseFloat(document.querySelector('input[name=\'length_1\']').value) || 0) * (parseFloat(this.value) || 0); document.querySelector('input[name=\'density_1\']').value = ((parseFloat(document.querySelector('input[name=\'weight_1\']').value) || 0) / ((parseFloat(document.querySelector('input[name=\'length_1\']').value) || 0) * (parseFloat(this.value) || 0) * (parseFloat(document.querySelector('input[name=\'height_1\']').value) || 0) / 1000000000)).toFixed(1)">
                                                   </div>
                                                   <div style="flex: 1.5; padding: 0;">
                                                       <input type="number" class="form-control form-control-sm" name="height_1" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem; border-radius: 0; text-align: center;" oninput="document.querySelector('input[name=\'density_1\']').value = ((parseFloat(document.querySelector('input[name=\'weight_1\']').value) || 0) / ((parseFloat(document.querySelector('input[name=\'length_1\']').value) || 0) * (parseFloat(document.querySelector('input[name=\'breadth_1\']').value) || 0) * (parseFloat(this.value) || 0) / 1000000000)).toFixed(1)">
                                                   </div>
                                               </div>
                                           </td>
                                           <td style="text-align: center;"><input type="number" class="form-control form-control-sm" name="area_1" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem; text-align: center;" readonly></td>
                                           <td><input type="number" class="form-control form-control-sm" name="weight_1" step="0.001" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="document.querySelector('input[name=\'density_1\']').value = ((parseFloat(this.value) || 0) / ((parseFloat(document.querySelector('input[name=\'length_1\']').value) || 0) * (parseFloat(document.querySelector('input[name=\'breadth_1\']').value) || 0) * (parseFloat(document.querySelector('input[name=\'height_1\']').value) || 0) / 1000000000)).toFixed(1)"></td>
                                           <td><input type="number" class="form-control form-control-sm" name="density_1" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" readonly></td>
                                           <td><input type="number" class="form-control form-control-sm" name="load_max_1" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateAverages()"></td>
                                           <td><input type="number" class="form-control form-control-sm" name="compressive_strength_1" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateAverages()"></td>
                                       </tr>
                                                                            <tr>
                                           <td style="text-align: center; vertical-align: middle; font-weight: bold;">2</td>
                                           <td><input type="text" class="form-control form-control-sm" name="block_id_2" placeholder="Block ID" style="font-size: 0.8rem; padding: 0.25rem;"></td>
                                           <td style="padding: 0; vertical-align: middle;">
                                               <div style="display: flex; height: 100%;">
                                                   <div style="flex: 1.5; padding: 0; border-right: 1px solid #dee2e6;">
                                                       <input type="number" class="form-control form-control-sm" name="length_2" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem; border-radius: 0; border-right: none; text-align: center;" oninput="document.querySelector('input[name=\'area_2\']').value = (parseFloat(this.value) || 0) * (parseFloat(document.querySelector('input[name=\'breadth_2\']').value) || 0); document.querySelector('input[name=\'density_2\']').value = ((parseFloat(document.querySelector('input[name=\'weight_2\']').value) || 0) / ((parseFloat(this.value) || 0) * (parseFloat(document.querySelector('input[name=\'breadth_2\']').value) || 0) * (parseFloat(document.querySelector('input[name=\'height_2\']').value) || 0) / 1000000000)).toFixed(1)">
                                                   </div>
                                                   <div style="flex: 1.5; padding: 0; border-right: 1px solid #dee2e6;">
                                                       <input type="number" class="form-control form-control-sm" name="breadth_2" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem; border-radius: 0; border-right: none; text-align: center;" oninput="document.querySelector('input[name=\'area_2\']').value = (parseFloat(document.querySelector('input[name=\'length_2\']').value) || 0) * (parseFloat(this.value) || 0); document.querySelector('input[name=\'density_2\']').value = ((parseFloat(document.querySelector('input[name=\'weight_2\']').value) || 0) / ((parseFloat(document.querySelector('input[name=\'length_2\']').value) || 0) * (parseFloat(this.value) || 0) * (parseFloat(document.querySelector('input[name=\'height_2\']').value) || 0) / 1000000000)).toFixed(1)">
                                                   </div>
                                                   <div style="flex: 1.5; padding: 0;">
                                                       <input type="number" class="form-control form-control-sm" name="height_2" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem; border-radius: 0; text-align: center;" oninput="document.querySelector('input[name=\'density_2\']').value = ((parseFloat(document.querySelector('input[name=\'weight_2\']').value) || 0) / ((parseFloat(document.querySelector('input[name=\'length_2\']').value) || 0) * (parseFloat(document.querySelector('input[name=\'breadth_2\']').value) || 0) * (parseFloat(this.value) || 0) / 1000000000)).toFixed(1)">
                                                   </div>
                                               </div>
                                           </td>
                                           <td style="text-align: center;"><input type="number" class="form-control form-control-sm" name="area_2" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem; text-align: center;" readonly></td>
                                           <td><input type="number" class="form-control form-control-sm" name="weight_2" step="0.001" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="document.querySelector('input[name=\'density_2\']').value = ((parseFloat(this.value) || 0) / ((parseFloat(document.querySelector('input[name=\'length_2\']').value) || 0) * (parseFloat(document.querySelector('input[name=\'breadth_2\']').value) || 0) * (parseFloat(document.querySelector('input[name=\'height_2\']').value) || 0) / 1000000000)).toFixed(1)"></td>
                                           <td><input type="number" class="form-control form-control-sm" name="density_2" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" readonly></td>
                                           <td><input type="number" class="form-control form-control-sm" name="load_max_2" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateAverages()"></td>
                                           <td><input type="number" class="form-control form-control-sm" name="compressive_strength_2" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateAverages()"></td>
                                       </tr>
                                                                            <tr>
                                           <td style="text-align: center; vertical-align: middle; font-weight: bold;">3</td>
                                           <td><input type="text" class="form-control form-control-sm" name="block_id_3" placeholder="Block ID" style="font-size: 0.8rem; padding: 0.25rem;"></td>
                                           <td style="padding: 0; vertical-align: middle;">
                                               <div style="display: flex; height: 100%;">
                                                   <div style="flex: 1.5; padding: 0; border-right: 1px solid #dee2e6;">
                                                       <input type="number" class="form-control form-control-sm" name="length_3" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem; border-radius: 0; border-right: none; text-align: center;" oninput="document.querySelector('input[name=\'area_3\']').value = (parseFloat(this.value) || 0) * (parseFloat(document.querySelector('input[name=\'breadth_3\']').value) || 0); document.querySelector('input[name=\'density_3\']').value = ((parseFloat(document.querySelector('input[name=\'weight_3\']').value) || 0) / ((parseFloat(this.value) || 0) * (parseFloat(document.querySelector('input[name=\'breadth_3\']').value) || 0) * (parseFloat(document.querySelector('input[name=\'height_3\']').value) || 0) / 1000000000)).toFixed(1)">
                                                   </div>
                                                   <div style="flex: 1.5; padding: 0; border-right: 1px solid #dee2e6;">
                                                       <input type="number" class="form-control form-control-sm" name="breadth_3" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem; border-radius: 0; border-right: none; text-align: center;" oninput="document.querySelector('input[name=\'area_3\']').value = (parseFloat(document.querySelector('input[name=\'length_3\']').value) || 0) * (parseFloat(this.value) || 0); document.querySelector('input[name=\'density_3\']').value = ((parseFloat(document.querySelector('input[name=\'weight_3\']').value) || 0) / ((parseFloat(document.querySelector('input[name=\'length_3\']').value) || 0) * (parseFloat(this.value) || 0) * (parseFloat(document.querySelector('input[name=\'height_3\']').value) || 0) / 1000000000)).toFixed(1)">
                                                   </div>
                                                   <div style="flex: 1.5; padding: 0;">
                                                       <input type="number" class="form-control form-control-sm" name="height_3" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem; border-radius: 0; text-align: center;" oninput="document.querySelector('input[name=\'density_3\']').value = ((parseFloat(document.querySelector('input[name=\'weight_3\']').value) || 0) / ((parseFloat(document.querySelector('input[name=\'length_3\']').value) || 0) * (parseFloat(document.querySelector('input[name=\'breadth_3\']').value) || 0) * (parseFloat(this.value) || 0) / 1000000000)).toFixed(1)">
                                                   </div>
                                               </div>
                                           </td>
                                           <td style="text-align: center;"><input type="number" class="form-control form-control-sm" name="area_3" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem; text-align: center;" readonly></td>
                                           <td><input type="number" class="form-control form-control-sm" name="weight_3" step="0.001" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="document.querySelector('input[name=\'density_3\']').value = ((parseFloat(this.value) || 0) / ((parseFloat(document.querySelector('input[name=\'length_3\']').value) || 0) * (parseFloat(document.querySelector('input[name=\'breadth_3\']').value) || 0) * (parseFloat(document.querySelector('input[name=\'height_3\']').value) || 0) / 1000000000)).toFixed(1)"></td>
                                           <td><input type="number" class="form-control form-control-sm" name="density_3" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" readonly></td>
                                                                                      <td><input type="number" class="form-control form-control-sm" name="load_max_3" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateAverages()"></td>
                                                                                       <td><input type="number" class="form-control form-control-sm" name="compressive_strength_3" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" oninput="calculateAverages()"></td>
                                       </tr>
                                       <!-- Average Row -->
                                       <tr class="table-secondary">
                                           <td colspan="6" class="text-end fw-bold" style="font-size: 1.2rem;">Average</td>
                                           <td class="text-center fw-bold">
                                               <input type="number" class="form-control form-control-sm" id="avg_load_max" name="avg_load_max" step="0.1" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" readonly>
                                           </td>
                                           <td class="text-center fw-bold">
                                               <input type="number" class="form-control form-control-sm" id="avg_compressive_strength" name="avg_compressive_strength" step="0.01" placeholder="" style="font-size: 0.8rem; padding: 0.25rem;" readonly>
                                           </td>
                                       </tr>
                                   </tbody>
                             </table>
                         </div>
                     </div>
                 </div>
             </div>
         </div>
 
         <!-- SECTION 5: Verification -->
         <div class="row mb-4">
             <div class="col-12">
                 <div class="card shadow-sm">
                                           <div class="card-header">
                          <h5 class="mb-0"><i class="fas fa-user-check me-2"></i>Verification</h5>
                      </div>
                                           <div class="card-body">
                          <div class="row">
                              <div class="col-md-4">
                                  <h6>Tested By</h6>
                                  <div class="mb-3">
                                      <label for="{{ form.tested_by_name.id }}" class="form-label">Name *</label>
                                      {{ form.tested_by_name(class="form-control", placeholder="Enter tester name") }}
                                      {% if form.tested_by_name.errors %}
                                      <div class="text-danger small">{{ form.tested_by_name.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                                  <div class="mb-3">
                                      <label for="{{ form.tested_by_date.id }}" class="form-label">Date *</label>
                                      {{ form.tested_by_date(class="form-control", type="date") }}
                                      {% if form.tested_by_date.errors %}
                                      <div class="text-danger small">{{ form.tested_by_date.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                              </div>
                              <div class="col-md-4">
                                  <h6>Checked By</h6>
                                  <div class="mb-3">
                                      <label for="{{ form.checked_by_name.id }}" class="form-label">Name *</label>
                                      {{ form.checked_by_name(class="form-control", placeholder="Enter checker name") }}
                                      {% if form.checked_by_name.errors %}
                                      <div class="text-danger small">{{ form.checked_by_name.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                                  <div class="mb-3">
                                      <label for="{{ form.checked_by_date.id }}" class="form-label">Date *</label>
                                      {{ form.checked_by_date(class="form-control", type="date") }}
                                      {% if form.checked_by_date.errors %}
                                      <div class="text-danger small">{{ form.checked_by_date.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                              </div>
                              <div class="col-md-4">
                                  <h6>Verified By</h6>
                                  <div class="mb-3">
                                      <label for="{{ form.verified_by_name.id }}" class="form-label">Name</label>
                                      {{ form.verified_by_name(class="form-control", value="Prakarsh A Sangave", readonly=true, style="background-color: rgba(108, 117, 125, 0.1); border-color: #495057; opacity: 0.9;") }}
                                      {% if form.verified_by_name.errors %}
                                      <div class="text-danger small">{{ form.verified_by_name.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                                  <div class="mb-3">
                                      <label for="{{ form.verified_by_date.id }}" class="form-label">Date *</label>
                                      {{ form.verified_by_date(class="form-control", type="date") }}
                                      {% if form.verified_by_date.errors %}
                                      <div class="text-danger small">{{ form.verified_by_date.errors[0] }}</div>
                                      {% endif %}
                                  </div>
                              </div>
                          </div>
                      </div>
                 </div>
             </div>
         </div>

                                       <!-- SECTION 6: Remarks -->
         <div class="row mb-4">
             <div class="col-12">
                 <div class="card shadow-sm">
                     <div class="card-header">
                         <h5 class="mb-0"><i class="fas fa-comment me-2"></i>Remarks</h5>
                     </div>
                     <div class="card-body">
                         <div class="mb-3">
                             <label for="{{ form.remarks.id }}" class="form-label">{{ form.remarks.label }}</label>
                             {{ form.remarks(class="form-control", rows="3", placeholder="Enter any additional remarks or observations...") }}
                             {% if form.remarks.errors %}
                             <div class="text-danger small">{{ form.remarks.errors[0] }}</div>
                             {% endif %}
                         </div>
                     </div>
                 </div>
             </div>
         </div>

                                       <!-- SECTION 7: Review & Authorization -->
         <div class="row mb-4">
             <div class="col-md-6">
                 <div class="card shadow-sm">
                     <div class="card-header">
                         <h5 class="mb-0"><i class="fas fa-user-check me-2"></i>Reviewed By</h5>
                     </div>
                     <div class="card-body">
                         <div class="mb-3">
                                                           <label for="{{ form.reviewed_by.id }}" class="form-label">Select Reviewer:</label>
                              <select class="form-select" id="{{ form.reviewed_by.id }}" name="{{ form.reviewed_by.name }}" required>
                                  <option value="">-- Select a reviewer --</option>
                                  <option value="Lalita S. Dussa - Quality Manager" selected>Lalita S. Dussa - Quality Manager</option>
                                  <option value="Prakarsha A. Sangave - Quality Manager">Prakarsha A. Sangave - Quality Manager</option>
                                  <option value="Harsha Prakarsha Sangave - Quality Manager">Harsha Prakarsha Sangave - Quality Manager</option>
                                  <option value="Amol A Adam - Quality Manager">Amol A Adam - Quality Manager</option>
                                  <option value="Aaquib J. Shaikh - Quality Manager">Aaquib J. Shaikh - Quality Manager</option>
                              </select>
                             {% if form.reviewed_by.errors %}
                             <div class="text-danger small">{{ form.reviewed_by.errors[0] }}</div>
                             {% endif %}
                         </div>
                     </div>
                 </div>
             </div>
             <div class="col-md-6">
                 <div class="card shadow-sm">
                     <div class="card-header">
                         <h5 class="mb-0"><i class="fas fa-user-lock me-2"></i>Authorized By</h5>
                     </div>
                     <div class="card-body">
                         <div class="mb-3">
                                                           <label for="{{ form.authorized_by.id }}" class="form-label">Authorized By:</label>
                              {{ form.authorized_by(class="form-control", value="Prakarsh Sangave", readonly=true, style="background-color: rgba(108, 117, 125, 0.1); border-color: #495057; opacity: 0.9;") }}
                             {% if form.authorized_by.errors %}
                             <div class="text-danger small">{{ form.authorized_by.errors[0] }}</div>
                             {% endif %}
                         </div>
                     </div>
                 </div>
             </div>
         </div>

                 <!-- Action Buttons -->
         <div class="row">
             <div class="col-12 text-center">
                                   <button type="submit" class="btn btn-primary btn-lg me-3">
                      <i class="fas fa-save me-2"></i>Save Test Data
                  </button>
                 <a href="{{ url_for('other_services') }}" class="btn btn-secondary btn-lg px-5">
                     <i class="fas fa-times me-2"></i>Cancel
                 </a>
             </div>
         </div>
    </form>
</div>

 <style>
 .card {
     transition: transform 0.2s ease-in-out;
 }

 .card:hover {
     transform: translateY(-2px);
 }

  .form-label {
      font-weight: normal;
      color: #ffffff;
  }

 .card-header {
     border-bottom: none;
 }

  .btn-lg {
      padding: 12px 30px;
      font-size: 1.1rem;
  }
 
 /* Center align numeric input fields in the table */
 .table input[type="number"] {
     text-align: center;
 }
 
 /* Center align text in table cells */
 .table td {
     text-align: center;
     vertical-align: middle;
 }
 
 /* Center align table headers */
 .table th {
     text-align: center;
     vertical-align: middle;
 }
 
 /* Ensure the Blocks ID text input is also centered */
 .table input[type="text"] {
     text-align: center;
 }
 </style>

 <script>
 // Global function to calculate averages for Load Maximum and Compressive Strength
 function calculateAverages() {
     let loadMaxSum = 0;
     let compressiveStrengthSum = 0;
     let validLoadMaxCount = 0;
     let validCompressiveStrengthCount = 0;
     
     // Calculate sum of all valid values for both columns
     for (let row = 1; row <= 3; row++) {
         const loadMaxField = document.querySelector(`input[name="load_max_${row}"]`);
         const compressiveStrengthField = document.querySelector(`input[name="compressive_strength_${row}"]`);
         
         if (loadMaxField) {
             const loadMax = parseFloat(loadMaxField.value) || 0;
             if (loadMax > 0) {
                 loadMaxSum += loadMax;
                 validLoadMaxCount++;
             }
         }
         
         if (compressiveStrengthField) {
             const compressiveStrength = parseFloat(compressiveStrengthField.value) || 0;
             if (compressiveStrength > 0) {
                 compressiveStrengthSum += compressiveStrength;
                 validCompressiveStrengthCount++;
             }
         }
     }
     
     // Calculate averages
     const avgLoadMax = validLoadMaxCount > 0 ? loadMaxSum / validLoadMaxCount : 0;
     const avgCompressiveStrength = validCompressiveStrengthCount > 0 ? compressiveStrengthSum / validCompressiveStrengthCount : 0;
     
     // Update average display
     const avgLoadMaxField = document.getElementById('avg_load_max');
     const avgCompressiveStrengthField = document.getElementById('avg_compressive_strength');
     
     if (avgLoadMaxField) {
         if (avgLoadMax > 0) {
             avgLoadMaxField.value = avgLoadMax.toFixed(1);
         } else {
             avgLoadMaxField.value = '';
         }
     }
     
     if (avgCompressiveStrengthField) {
         if (avgCompressiveStrength > 0) {
             avgCompressiveStrengthField.value = avgCompressiveStrength.toFixed(2);
         } else {
             avgCompressiveStrengthField.value = '';
         }
     }
     
     console.log('Averages calculated:', {
         loadMaxSum,
         validLoadMaxCount,
         avgLoadMax,
         compressiveStrengthSum,
         validCompressiveStrengthCount,
         avgCompressiveStrength
     });
 }

 document.addEventListener('DOMContentLoaded', function() {
     // Set default dates to today
     const today = new Date().toISOString().split('T')[0];
     
     // Function to set today's date for all date fields
     function setTodayDate() {
         const dateFields = [
             'date_of_testing',
             'tested_by_date',
             'checked_by_date',
             'verified_by_date'
         ];
         
         dateFields.forEach(fieldId => {
             const field = document.getElementById(fieldId);
             if (field) {
                 field.value = today;
                 console.log(`Set ${fieldId} to today's date: ${today}`);
             }
         });
         
         // Also set dates using form field IDs if they exist
         const formDateFields = [
             '{{ form.date_of_testing.id }}',
             '{{ form.tested_by_date.id }}',
             '{{ form.checked_by_date.id }}',
             '{{ form.verified_by_date.id }}'
         ];
         
         formDateFields.forEach(fieldId => {
             const field = document.getElementById(fieldId);
             if (field) {
                 field.value = today;
                 console.log(`Set form field ${fieldId} to today's date: ${today}`);
             }
         });
     }
     
     // Set today's date immediately
     setTodayDate();
     

     
     // Function to calculate area for a specific row
     function calculateArea(rowNumber) {
         console.log(`Calculating area for row ${rowNumber}...`);
         
         const lengthField = document.querySelector(`input[name="length_${rowNumber}"]`);
         const breadthField = document.querySelector(`input[name="breadth_${rowNumber}"]`);
         const areaField = document.querySelector(`input[name="area_${rowNumber}"]`);
         
         console.log('Fields found:', { lengthField, breadthField, areaField });
         
         if (!lengthField || !breadthField || !areaField) {
             console.error('One or more fields not found for row', rowNumber);
             return;
         }
         
         const length = parseFloat(lengthField.value) || 0;
         const breadth = parseFloat(breadthField.value) || 0;
         
         console.log(`Row ${rowNumber}: Length=${length}, Breadth=${breadth}`);
         
         // Calculate area: L × B
         const area = length * breadth;
         
         console.log(`Row ${rowNumber}: Area calculated = ${area}`);
         
         // Update area field with calculated value
         areaField.value = area.toFixed(2);
         
         console.log(`Row ${rowNumber}: Area field updated to ${areaField.value}`);
     }
     

     
     // Add event listeners for L and B input fields for all three rows
     for (let row = 1; row <= 3; row++) {
         const lengthField = document.querySelector(`input[name="length_${row}"]`);
         const breadthField = document.querySelector(`input[name="breadth_${row}"]`);
         const loadMaxField = document.querySelector(`input[name="load_max_${row}"]`);
         const compressiveStrengthField = document.querySelector(`input[name="compressive_strength_${row}"]`);
         
         console.log(`Row ${row}:`, { lengthField, breadthField, loadMaxField, compressiveStrengthField });
         
         // Add event listeners for L and B fields (triggers area calculation)
         if (lengthField) {
             lengthField.addEventListener('input', () => {
                 console.log(`Length ${row} changed to:`, lengthField.value);
                 calculateArea(row);
             });
         }
         if (breadthField) {
             breadthField.addEventListener('input', () => {
                 console.log(`Breadth ${row} changed to:`, breadthField.value);
                 calculateArea(row);
             });
         }
         
         // Add event listeners for Load Maximum and Compressive Strength fields (triggers average calculation)
         if (loadMaxField) {
             loadMaxField.addEventListener('input', () => {
                 console.log(`Load Max ${row} changed to:`, loadMaxField.value);
                 calculateAverages();
             });
             loadMaxField.addEventListener('change', () => {
                 console.log(`Load Max ${row} changed to:`, loadMaxField.value);
                 calculateAverages();
             });
         }
         if (compressiveStrengthField) {
             compressiveStrengthField.addEventListener('input', () => {
                 console.log(`Compressive Strength ${row} changed to:`, compressiveStrengthField.value);
                 calculateAverages();
             });
             compressiveStrengthField.addEventListener('change', () => {
                 console.log(`Compressive Strength ${row} changed to:`, compressiveStrengthField.value);
                 calculateAverages();
             });
         }
     }
     

     
     // Test calculation on page load
     console.log('Testing calculation on page load...');
     calculateArea(1);
     
     calculateAverages();
 });
 </script>
</style>
{% endblock %}
