<!-- JavaScript for bulk actions in dashboard -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Pending tab checkboxes
    const pendingSelectAllCheckbox = document.querySelector('.pending-select-all-checkbox');
    const pendingSelectAllBtn = document.querySelector('.pending-select-all');
    const pendingDeselectAllBtn = document.querySelector('.pending-deselect-all');
    
    if (pendingSelectAllCheckbox) {
        // Select all checkbox in table header
        pendingSelectAllCheckbox.addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('#pendingBulkForm .test-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = pendingSelectAllCheckbox.checked;
            });
        });
        
        // Select all button
        pendingSelectAllBtn.addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('#pendingBulkForm .test-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            pendingSelectAllCheckbox.checked = true;
        });
        
        // Deselect all button
        pendingDeselectAllBtn.addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('#pendingBulkForm .test-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            pendingSelectAllCheckbox.checked = false;
        });
    }
    
    // Completed tab checkboxes
    const completedSelectAllCheckbox = document.querySelector('.completed-select-all-checkbox');
    const completedSelectAllBtn = document.querySelector('.completed-select-all');
    const completedDeselectAllBtn = document.querySelector('.completed-deselect-all');
    
    if (completedSelectAllCheckbox) {
        // Select all checkbox in table header
        completedSelectAllCheckbox.addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('#completedBulkForm .test-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = completedSelectAllCheckbox.checked;
            });
        });
        
        // Select all button
        completedSelectAllBtn.addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('#completedBulkForm .test-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            completedSelectAllCheckbox.checked = true;
        });
        
        // Deselect all button
        completedDeselectAllBtn.addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('#completedBulkForm .test-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            completedSelectAllCheckbox.checked = false;
        });
    }
    
    // Validate form submission - make sure at least one checkbox is selected
    document.querySelectorAll('#pendingBulkForm, #completedBulkForm').forEach(form => {
        form.addEventListener('submit', function(e) {
            const checkboxes = form.querySelectorAll('.test-checkbox:checked');
            const bulkAction = form.querySelector('select[name="bulk_action"]').value;
            
            if (checkboxes.length === 0) {
                e.preventDefault();
                alert('Please select at least one test');
                return false;
            }
            
            if (!bulkAction) {
                e.preventDefault();
                alert('Please select an action');
                return false;
            }
            
            // Ask for confirmation
            if (!confirm(`Are you sure you want to ${bulkAction.replace('_', ' ')} ${checkboxes.length} selected tests?`)) {
                e.preventDefault();
                return false;
            }
            
            return true;
        });
    });
});
</script>