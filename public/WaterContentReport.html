<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
   <meta name="timestamp" content="2025-01-27-v1">
  <title>Vitrag Associates LLP - Water Content Test Report (A4)</title>
  <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root{
      --paper-width:210mm;
      --paper-height:297mm;
      --page-padding:14mm;
      --title-color:#b30000;
      --subtitle-color:#063a6c;
      --inner-border:1px solid #222;
      --muted:#666;
      --header-font:'Times New Roman', Times, serif;
      --base-font-size:16px;
    }

    @page { size: A4; margin: 10mm; }
    html,body{height:100%; margin:0; padding:0;}
    body{
      font-family:var(--header-font);
      -webkit-print-color-adjust:exact;
      background:#ffffff;
      margin:0;
      padding:0;
      color:#111;
      display:flex;
      flex-direction:column;
      align-items:center;
      min-height:100vh;
    }

    .page{
      width:var(--paper-width);
      min-height:var(--paper-height);
      background:#fff;
      box-shadow:0 0 20px rgba(0,0,0,0.1);
      padding:var(--page-padding);
      box-sizing:border-box;
      position:relative;
      font-size:var(--base-font-size);
      line-height:1.15;
      margin:20px 0;
      border:1px solid #ddd;
    }

     /* Header */
     .header{ width:100%; border-collapse:collapse; table-layout:fixed; }
     .header td{ border:1px solid #111; vertical-align:middle; padding:12px 16px; }
     .logo-cell{ width:3.26cm; text-align:center; }
     .logo-cell img{ width:3.26cm; height:auto; object-fit:contain; }
     .title-cell{ text-align:center; font-weight:700; }
     .title-cell h1{ margin:0; font-size:33px; font-weight:700; color:var(--title-color); text-transform:uppercase; line-height:1.0; }
     .title-cell .subtitle{ display:block; margin-top:8px; font-size:19px; font-weight:700; color:var(--subtitle-color); line-height:1.0; white-space:nowrap; }

     /* Title box */
     .box{ margin-top:10px; border:1px solid #111; font-weight:700; font-size:16px; text-transform:uppercase; text-decoration:underline; text-underline-offset: 4px; height:1cm; width:100%; display:flex; align-items:center; justify-content:center; }

    /* Metadata table */
    .meta-wrap{ margin-top:10px; }
    table.meta{ 
      width:100% !important; 
      border-collapse:collapse; 
      table-layout:fixed !important; 
      word-wrap: break-word;
    }
    
    /* Force table layout and column widths */
    table.meta col:nth-child(1) { width: 20% !important; }
    table.meta col:nth-child(2) { width: 30% !important; }
    table.meta col:nth-child(3) { width: 20% !important; }
    table.meta col:nth-child(4) { width: 30% !important; }
    table.meta td{ 
      border:1px solid #111; 
      padding:0 6px; 
      height:0.7cm; 
      vertical-align:middle; 
      font-size:14.67px;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
    }
    
    /* Force column widths with constraints */
    table.meta td:nth-child(1){ 
      width: 20% !important; 
      max-width: 20% !important; 
      min-width: 20% !important; 
      overflow: hidden;
    }
    table.meta td:nth-child(2){ 
      width: 30% !important; 
      max-width: 30% !important; 
      min-width: 30% !important; 
    }
    table.meta td:nth-child(3){ 
      width: 20% !important; 
      max-width: 20% !important; 
      min-width: 20% !important; 
      overflow: hidden;
    }
    table.meta td:nth-child(4){ 
      width: 30% !important; 
      max-width: 30% !important; 
      min-width: 30% !important; 
    }
    
    /* Special case for merged cell in Sample Condition row */
    table.meta tr:nth-child(5) td:nth-child(3){ 
      width: 50% !important; 
      max-width: 50% !important; 
      min-width: 50% !important; 
    }
    
    /* Responsive text sizing for long content */
    #sample-description, #environmental-conditions {
        font-size: 12px !important;
        line-height: 1.2;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    /* Adjust cell height for smaller text */
    #sample-description, #environmental-conditions {
        height: auto !important;
        min-height: 0.7cm;
        padding: 2px 6px !important;
    }

    /* Test result */
    .test-result{ margin-top:24px; padding:0; }
     .test-result h3{ margin:0; text-align:center; font-size:16px; font-weight:700; text-transform:uppercase; text-decoration:underline; text-underline-offset: 4px; border:none; }

    table.results{ width:100%; border-collapse:collapse; margin-top:8px; font-size:14.67px; table-layout:fixed !important; }
    table.results th, table.results td{ border:1px solid #111; text-align:center; vertical-align:middle; }
    
    /* Force column widths with colgroup */
    table.results col:nth-child(1) { width: 8% !important; }
    table.results col:nth-child(2) { width: 60% !important; }
    table.results col:nth-child(3) { width: 32% !important; }
    
    table.results thead th{ background:#f7f2f2; font-weight:700; font-size:16px; padding:4px; }
    table.results tbody tr{ height:0.8cm; }
    table.results th:first-child, table.results td:first-child{ width:8% !important; min-width:8% !important; max-width:8% !important; }
    table.results th:nth-child(2){ width:60% !important; min-width:60% !important; max-width:60% !important; text-align:center; }
    table.results td:nth-child(2){ width:60% !important; min-width:60% !important; max-width:60% !important; text-align:left; padding-left:8px; }
    table.results th:nth-child(3), table.results td:nth-child(3){ width:32% !important; min-width:32% !important; max-width:32% !important; }
    table.results tfoot td{ border:1px solid #111; height:1.2cm; font-weight:700; text-align:left; padding-left:6px; }
    table.results tfoot td:first-child{ text-align:right; padding-right:6px; }
    table.results tfoot td:last-child{ text-align:center; }
    table.results tfoot tr:nth-child(2) td{ height:60mm; vertical-align:top; text-align:left; padding:8px; font-weight:normal; }
    table.results tfoot tr:nth-child(3) td, table.results tfoot tr:nth-child(4) td, table.results tfoot tr:nth-child(5) td{ height:0.7cm; font-weight:700; padding:4px; text-align:left; }
    
    /* Force column widths for signature table */
    table.results tfoot tr:nth-child(3) td:first-child{ width:25% !important; }
    table.results tfoot tr:nth-child(3) td:nth-child(2){ width:30% !important; }
    table.results tfoot tr:nth-child(3) td:last-child{ width:35% !important; }
    table.results tfoot tr:nth-child(4) td:first-child{ width:25% !important; }
    table.results tfoot tr:nth-child(4) td:nth-child(2){ width:30% !important; }
    table.results tfoot tr:nth-child(4) td:last-child{ width:35% !important; }
    table.results tfoot tr:nth-child(5) td:first-child{ width:25% !important; }
    table.results tfoot tr:nth-child(5) td:nth-child(2){ width:30% !important; }
    table.results tfoot tr:nth-child(5) td:last-child{ width:35% !important; }

    .sig-title{ font-weight:700; }

     .doc-footer{ position:absolute; bottom:2mm; left:var(--page-padding); right:var(--page-padding); text-align:center; font-size:16px; color:var(--muted); }

    /* Download PDF Button */
    .download-btn{ 
      position:fixed; 
      top:20px; 
      right:20px; 
      background:#28a745; 
      color:white; 
      border:none; 
      padding:12px 20px; 
      border-radius:6px; 
      font-size:14px; 
      font-weight:bold; 
      cursor:pointer; 
      box-shadow:0 2px 8px rgba(0,0,0,0.2);
      z-index:1000;
    }
    .download-btn:hover{ background:#218838; }

    @media print{ 
      body{ 
        background:white; 
        margin: 0;
                padding: 0;
            }
      .page{ 
        box-shadow:none; 
        margin: 0;
        padding: 14mm;
        width: 210mm;
        min-height: 297mm;
        max-height: 297mm;
        overflow: hidden;
      } 
      .download-btn{ display:none !important; }
      
      /* Ensure exact A4 dimensions */
      @page {
        size: A4;
                margin: 0;
            }
            
      /* Hide any elements that might cause page breaks */
      .page * {
        -webkit-print-color-adjust: exact !important;
        color-adjust: exact !important;
            }
        }
  </style>
</head>
<body>
  <div class="page">

             <table class="header">
        <tr>
          <td class="logo-cell"><img src="/logo.png" alt="Vitrag Associates logo"></td>
          <td class="title-cell">
            <h1>VITRAG ASSOCIATES LLP</h1>
            <div class="subtitle">(CONSTRUCTION MATERIAL TESTING LABORATORY)</div>
          </td>
        </tr>
             </table>

    <div class="meta-wrap">
      <table class="meta">
        <colgroup>
          <col style="width: 20%;">
          <col style="width: 30%;">
          <col style="width: 20%;">
          <col style="width: 30%;">
        </colgroup>
        <tr>
          <td colspan="4" style="text-align:center; font-weight:bold; text-decoration:underline; font-size:21.33px; height:1cm;">Determination of Water Content (Oven-Drying Method)</td>
        </tr>
        <tr>
          <td><strong>Sample Test Code Number</strong></td>
          <td id="sample-test-code"></td>
          <td><strong>Sample Description</strong></td>
          <td id="sample-description"></td>
        </tr>
        <tr>
          <td><strong>Date of Receipt</strong></td>
          <td id="date-of-receipt"></td>
          <td><strong>Date of Testing</strong></td>
          <td id="date-of-testing"></td>
        </tr>
        <tr>
          <td><strong>Quantity</strong></td>
          <td id="quantity"></td>
          <td><strong>Test Method</strong></td>
          <td id="test-method" style="text-align: left; vertical-align: middle; font-weight: bold;"><strong>IS 2720 (PART 2)-1973</strong></td>
        </tr>
        <tr>
          <td><strong>Sample Condition</strong></td>
          <td colspan="3" id="sample-condition"></td>
        </tr>
      </table>
            </div>

            <!-- Test Result Table -->
            <div style="margin-top: 24px;">
                <table class="results">
                    <colgroup>
                        <col style="width: 8%;">
                        <col style="width: 60%;">
                        <col style="width: 32%;">
                    </colgroup>
                    <thead>
                        <tr>
                            <td colspan="3" style="text-align:center; font-weight:bold; text-decoration:underline; font-size:21.33px; height:1cm;">TEST RESULT</td>
                        </tr>
                        <tr>
                            <th style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle; background: #f7f2f2; font-weight: 700; font-size: 16px;">Sr.No.</th>
                            <th style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle; background: #f7f2f2; font-weight: 700; font-size: 16px;">Description</th>
                            <th style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle; background: #f7f2f2; font-weight: 700; font-size: 16px;">Result</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;">1</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: left; vertical-align: middle; padding-left: 8px;">Container No.</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;" id="container-no"></td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;">2</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: left; vertical-align: middle; padding-left: 8px;">Mass of container W‚ÇÅ, in g</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;" id="mass-container"></td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;">3</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: left; vertical-align: middle; padding-left: 8px;">Mass of container and wet soil W‚ÇÇ, in g</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;" id="mass-container-wet-soil"></td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;">4</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: left; vertical-align: middle; padding-left: 8px;">Mass of container and dry soil W‚ÇÉ, in g</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;" id="mass-container-dry-soil"></td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;">5</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: left; vertical-align: middle; padding-left: 8px;">Mass of moisture ( W‚ÇÇ - W‚ÇÉ ), in g</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;" id="mass-moisture"></td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;">6</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: left; vertical-align: middle; padding-left: 8px;">Mass of dry soil ( W‚ÇÉ - W‚ÇÅ ), in g</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;" id="mass-dry-soil"></td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;">7</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: left; vertical-align: middle; padding-left: 8px;">Water Content (%) (( W‚ÇÇ - W‚ÇÉ ) x 100)/( W‚ÇÉ - W‚ÇÅ)</td>
                            <td style="border: 1px solid #111; padding: 6px; text-align: center; vertical-align: middle;" id="water-content-percentage"></td>
                        </tr>
                        <!-- Integrated REMARK Row -->
                        <tr>
                            <td colspan="3" style="border: 1px solid #111; padding: 6px; text-align: left; font-weight: bold; height: 5cm; vertical-align: top;">
                                <strong>REMARK:</strong>
                                <div style="margin-top: 8px; font-weight: normal; min-height: 4.5cm;"></div>
                            </td>
                        </tr>
            <!-- Signatures Section -->
            <div style="margin-top: 24px;">
                <table style="width: 100%; border-collapse: collapse; border: 1px solid #111;">
                    <tr>
                        <td class="sig-title" colspan="2" style="width:25% !important; border: 1px solid #111; padding: 6px;">Tested By: <span id="tested-by-name">John Doe</span></td>
                        <td class="sig-title" colspan="2" style="width:30% !important; border: 1px solid #111; padding: 6px;">Checked By: <span id="checked-by-name">Jane Smith</span></td>
                        <td class="sig-title" colspan="3" style="width:35% !important; border: 1px solid #111; padding: 6px;">Verified By: <span id="verified-by-name">Prakarsh A Sangave</span></td>
                    </tr>
                    <tr>
                        <td colspan="2" style="width:25% !important; border: 1px solid #111; padding: 6px;"><strong>Date:</strong> <span id="tested-by-date"></span></td>
                        <td colspan="2" style="width:30% !important; border: 1px solid #111; padding: 6px;"><strong>Date:</strong> <span id="checked-by-date"></span></td>
                        <td colspan="3" style="width:35% !important; border: 1px solid #111; padding: 6px;"><strong>Date:</strong> <span id="verified-by-date"></span></td>
                    </tr>
                    <tr>
                        <td colspan="2" style="width:25% !important; border: 1px solid #111; padding: 6px;"><strong>Sign:</strong></td>
                        <td colspan="2" style="width:30% !important; border: 1px solid #111; padding: 6px;"><strong>Sign:</strong></td>
                        <td colspan="3" style="width:35% !important; border: 1px solid #111; padding: 6px;"><strong>Sign:</strong></td>
                    </tr>
                </table>
            </div>
                    </tbody>
                </table>
            </div>


            </div>


  <!-- Download PDF Button -->
  <button class="download-btn" onclick="downloadPDF()">üìÑ Download PDF</button>

    <script>
        // Function to populate form data from URL parameters
        function populateFormData() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // General Information
            document.getElementById('sample-test-code').textContent = urlParams.get('sample_test_code') || '';
            document.getElementById('sample-description').textContent = urlParams.get('sample_description') || '';
            document.getElementById('date-of-receipt').textContent = urlParams.get('date_of_receipt') || '';
            document.getElementById('date-of-testing').textContent = urlParams.get('date_of_testing') || '';
            document.getElementById('quantity').textContent = urlParams.get('quantity') || '';
            document.getElementById('sample-condition').textContent = urlParams.get('sample_condition') || '';
            
            // Test Method - keep default if not provided
            const testMethodValue = urlParams.get('test_method') || 'IS 2720 (PART 2)-1973';
            document.getElementById('test-method').innerHTML = '<strong>' + testMethodValue + '</strong>';
            
            // Water Content Determination Data
            document.getElementById('container-no').textContent = urlParams.get('water_container_no') || '';
            document.getElementById('mass-container').textContent = urlParams.get('water_mass_container') || '';
            document.getElementById('mass-container-wet-soil').textContent = urlParams.get('water_mass_container_wet_soil') || '';
            document.getElementById('mass-container-dry-soil').textContent = urlParams.get('water_mass_container_dry_soil') || '';
            document.getElementById('mass-moisture').textContent = urlParams.get('water_mass_moisture') || '';
            document.getElementById('mass-dry-soil').textContent = urlParams.get('water_mass_dry_soil') || '';
            document.getElementById('water-content-percentage').textContent = urlParams.get('water_content_percentage') || '';
            
            // Signatures
            document.getElementById('tested-by-name').textContent = urlParams.get('tested_by_name') || 'John Doe';
            document.getElementById('tested-by-date').textContent = urlParams.get('tested_by_date') || '';
            document.getElementById('checked-by-name').textContent = urlParams.get('checked_by_name') || 'Jane Smith';
            document.getElementById('checked-by-date').textContent = urlParams.get('checked_by_date') || '';
            document.getElementById('verified-by-name').textContent = urlParams.get('verified_by_name') || 'Prakarsh A Sangave';
            document.getElementById('verified-by-date').textContent = urlParams.get('verified_by_date') || '';
        }
        

         // Populate form data when page loads
         window.onload = function() {
             populateFormData();
         };

         // Force cache refresh
         if (window.location.search.indexOf('v=') === -1) {
             window.location.search += (window.location.search ? '&' : '?') + 'v=' + Date.now();
         }

        // Print function
        function printReport() {
            window.print();
        }

        // Download PDF function - Direct PDF generation without pop-up
        function downloadPDF() {
            console.log('Download PDF clicked');
            
            // Get customer name for default filename
            const urlParams = new URLSearchParams(window.location.search);
            const testedByName = urlParams.get('tested_by_name') || 'John_Doe';
            const sampleTestCode = urlParams.get('sample_test_code') || 'ST-001';
            const dateOfTesting = urlParams.get('date_of_testing') || new Date().toISOString().split('T')[0];
            
            // Create default filename
            const customerName = testedByName.replace(/\s+/g, '_');
            const defaultFilename = `Water_Content_Test_Report_${customerName}_${sampleTestCode}_${dateOfTesting}.pdf`;
            
            // Set the document title for print dialog
            document.title = defaultFilename;
            
            // Add print-specific CSS
            const printStyle = document.createElement('style');
            printStyle.textContent = `
              @media print {
                body { margin: 0; padding: 0; }
                .page { box-shadow: none; margin: 0; }
                .no-print { display: none !important; }
              }
            `;
            document.head.appendChild(printStyle);
            
            // Hide the download button during print
            const downloadBtn = document.querySelector('button[onclick="downloadPDF()"]');
            if (downloadBtn) {
              downloadBtn.classList.add('no-print');
            }
            
            // Open print dialog directly without pop-up
            window.print();
            
            // Clean up after print
            setTimeout(() => {
              if (downloadBtn) {
                downloadBtn.classList.remove('no-print');
              }
              document.head.removeChild(printStyle);
            }, 1000);
        }
    </script>
</body>
</html>
